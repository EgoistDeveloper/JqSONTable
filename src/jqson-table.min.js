!function($){"use strict";var timeOutMaxRetry=10,timeOutCurrentRetry,tableLastUpdate=new Date,tableUpdateLoop=setInterval(function(){tableLoader()},6e4),options=[],language=null,tableDefaultOptions={ajax:{url:null,urlDelimeter:"?",timeOut:3e4,reloadDelay:10,async:!1,beforeSend:null,afterSend:null,success:null,error:null,logError:!0},pagination:{page:1,limit:25,order:"desc",order_by:"id",like:""},table:{headerOrder:!0,search:!0,limit:!0,pagination:!0,rowItem:null,rowTr:null,paginationHistory:!0,prefix:"",numbers:!0,except:[],actions:null,actionColor:"primary",columns:[],numText:"Num",actionsText:"Actions",showingText:"Showing #showing# of #total# items.",showingNoneText:"There is no reuslt",tfoot:!0}},selectDefaultOptions={ajax:{url:null,urlDelimeter:"?",params:null,timeOut:3e4,async:!1,beforeSend:null,afterSend:null,success:null,error:null,logError:!0},results:null,selectedValue:null,defaultOption:null,optionItem:null},listDefaultOptions={ajax:{url:null,urlDelimeter:"?",params:null,timeOut:3e4,async:!1,beforeSend:null,afterSend:null,success:null,error:null,logError:!0},itemType:"li",results:null,selectedKey:null,selectedValue:null,listItem:null};function printError(jqXHR,textStatus,errorThrown){console.log("--------------------------------------:"),console.log("------------- ERROR Start ------------:"),console.log("-------------jqXHR------------:"),console.log(jqXHR),console.log("----------textStatus----------:"),console.log(textStatus),console.log("----------errorThrown----------:"),console.log(errorThrown),console.log("------------- ERROR End --------------:"),console.log("--------------------------------------:")}function ajaxGetTable(id){var _response=null,url=options[id].ajax.url+options[id].ajax.urlDelimeter+$.param(options[id].pagination);return $.ajax({url:url,type:"GET",timeOut:options[id].ajax.timeOut,dataType:"json",async:options[id].ajax.async,beforeSend:function(request){options[id].ajax.beforeSend&&options[id].ajax.beforeSend(request)},success:function(response){options[id].ajax.success&&options[id].ajax.success(response),_response=response,window[id].data=response},error:function(jqXHR,textStatus,errorThrown){if(options[id].ajax.logError&&printError(jqXHR,textStatus,errorThrown),options[id].ajax.error&&options[id].ajax.error(jqXHR,textStatus,errorThrown),"timeout"==textStatus&&timeOutMaxRetry<timeOutCurrentRetry)return++timeOutCurrentRetry,getTable()}}).done(function(){options[id].ajax.afterSend&&"function"==typeof options[id].ajax.afterSend&&options[id].ajax.afterSend()}),_response}function ajaxGetData(id){var _response=null,url=options[id].ajax.url;return $.ajax({url:url,type:"GET",timeOut:options[id].ajax.timeOut,dataType:"json",async:options[id].ajax.async,beforeSend:function(request){options[id].ajax.beforeSend&&options[id].ajax.beforeSend(request)},success:function(response){options[id].ajax.success&&options[id].ajax.success(response),_response=response,window[id].data=response},error:function(jqXHR,textStatus,errorThrown){if(options[id].ajax.logError&&printError(jqXHR,textStatus,errorThrown),options[id].ajax.error&&options[id].ajax.error(jqXHR,textStatus,errorThrown),"timeout"==textStatus&&timeOutMaxRetry<timeOutCurrentRetry)return++timeOutCurrentRetry,getTable()}}).done(function(){options[id].ajax.afterSend&&"function"==typeof options[id].ajax.afterSend&&options[id].ajax.afterSend()}),_response}function diffMinutes(date1,date2){var diff=(date2.getTime()-date1.getTime())/1e3;return diff/=60,Math.abs(Math.round(diff))}function setCookie(name,value,days){if(days=void 0===days?365:days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+value+expires+"; path=/"}function getCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function eraseCookie(name){createCookie(name,"",-1)}function tableLoader(initial_load,table,id){if(table)(initial_load||diffMinutes(new Date,tableLastUpdate)>=options[id].ajax.reloadDelay)&&loadTable(table,id);else{var tables=$("table");tables.length>0?$.each(tables,function(){var _this=$(this),id=_this.attr("id");(initial_load||diffMinutes(new Date,tableLastUpdate)>=options[id].ajax.reloadDelay)&&loadTable(_this,id)}):clearInterval(tableUpdateLoop)}}function loadTable(table,id){if(options[id].loader&&$(".loader").show(),options[id].ajax){var response=ajaxGetTable(id);if(response){var tableContent=tableBuilder(response.results,id),newTableHTML="",pagination=options[id].table.pagination,paginationContent="",resultsContent=response.pagination.page>0?options[id].table.showingText.replace("#showing#",response.results.length).replace("#total#",response.total_results):options[id].table.showingNoneText;pagination&&!0===pagination?paginationContent=buildPagination(response.pagination):"function"==typeof pagination&&(paginationContent=pagination(response.pagination)),"jqson-table"==table.parent().attr("id")?(table.html(tableContent),table.parent().find("#jqson-footer>#pagination").html(paginationContent),table.parent().find("#jqson-results").html(resultsContent)):(paginationContent&&newTableHTML.replace("#pagination#",paginationContent),tableContent&&(newTableHTML='<div id="jqson-table" class="table-responsive jqson-container random-pagination"><div id="jqson-header" class="justify-content-between"><div class="float-right options"><button id="search-on-table" type="button" class="button" title="Search in Table"><i class="fa fa-search"></i></button><button id="refresh-table" type="button" class="button" title="Reload Table Contents"> <i class="fa fa-sync"></i> </button></div><div id="jqson-search" class="row m-0 d-none"><div class="col-lg-11"><input id="table-search" type="search" class="form-control rounded-input" placeholder="Search"></div><div class="col-lg-1"><button id="table-search-button" type="button" class="btn btn-primary btn-rounded">Search</button></div></div></div><br>'+table[0].outerHTML.replace("</table>",tableContent+"</table>")+'<div id="jqson-footer" class="row justify-content-between align-items-baseline" style="margin: 0px; padding: 0px 10px;"><div id="pagination" class="pagination">'+paginationContent+'</div><div id="jqson-results">'+resultsContent+"</div></div></div>",table.parent().html(newTableHTML))),$(".loader").hide()}else console.log("There is no data.")}else console.log("Missing AJAX")}function loadTableData(data,table,id){if(data){var tableContent=tableBuilder(data.results,id),newTableHTML="",pagination=options[id].table.pagination,paginationContent="",resultsContent=data.pagination.page>0?options[id].table.showingText.replace("#showing#",data.results.length).replace("#total#",data.total_results):options[id].table.showingNoneText;pagination&&!0===pagination?paginationContent=buildPagination(data.pagination):"function"==typeof pagination&&(paginationContent=pagination(data.pagination)),"jqson-table"==table.parent().attr("id")?(table.html(tableContent),table.parent().find("#jqson-footer>#pagination").html(paginationContent),table.parent().find("#jqson-results").html(resultsContent)):(paginationContent&&newTableHTML.replace("#pagination#",paginationContent),tableContent&&(newTableHTML='<div id="jqson-table" class="table-responsive jqson-container random-pagination"><div id="jqson-header" class="justify-content-between"><div class="float-right options"><button id="search-on-table" type="button" class="button" title="Search in Table"><i class="fa fa-search"></i></button><button id="refresh-table" type="button" class="button" title="Reload Table Contents"> <i class="fa fa-sync"></i> </button></div><div id="jqson-search" class="row m-0 d-none"><div class="col-lg-11"><input id="table-search" type="search" class="form-control rounded-input" placeholder="Search"></div><div class="col-lg-1"><button id="table-search-button" type="button" class="btn btn-primary btn-rounded">Search</button></div></div></div><br>'+table[0].outerHTML.replace("</table>",tableContent+"</table>")+'<div id="jqson-footer" class="row justify-content-between align-items-baseline" style="margin: 0px; padding: 0px 10px;"><div id="pagination" class="pagination">'+paginationContent+'</div><div id="jqson-results">'+resultsContent+"</div></div></div>",table.parent().html(newTableHTML))),$(".loader").hide()}else console.log("There is no data.")}function buildPagination(pagination){if(0==pagination.last||1==pagination.last)return"";var paginationHtml="";return paginationHtml=1!=pagination.page?'<button data-index="'+(pagination.page-1)+'" class="btn btn-default">&laquo;</button>':'<button data-index="'+pagination.start+'" class="btn btn-default"" disabled>&laquo;</button>',pagination.page>7&&(paginationHtml+='<button data-index="1" class="btn btn-default">1</button>',paginationHtml+='<button class="btn btn-default" disabled>•••</button>'),pagination.left.length>0&&pagination.left.forEach(el=>{paginationHtml+='<button data-index="'+el+'" class="btn btn-default">'+el+"</button>"}),paginationHtml+='<button data-index="'+pagination.page+'" class="btn btn-default active">'+pagination.page+"</button>",pagination.right.length>0&&pagination.right.forEach(el=>{paginationHtml+='<button data-index="'+el+'" class="btn btn-default">'+el+"</button>"}),pagination.end<pagination.last&&(pagination.last-pagination.page>10&&(paginationHtml+='<button class="btn btn-default" disabled>•••</button>'),paginationHtml+='<button data-index="'+pagination.last+'" class="btn btn-default">'+pagination.last+"</button>"),pagination.page!=pagination.end?paginationHtml+='<button data-index="'+(pagination.page+1)+'" class="btn btn-default"">&raquo;</button>':paginationHtml+='<button data-index="'+pagination.end+'" class="btn btn-default" disabled>&raquo;</button>',paginationHtml}function tableBuilder(results,id){var thead="",tbody="",tfoot="";if(results&&results[0]){if(thead="<thead><tr>",options[id].table.numbers&&language?thead+="<th>"+language.num+"</th>":options[id].table.numbers&&!language&&(thead+="<th>"+options[id].table.numText+"</th>"),options[id].table.columns&&options[id].table.columns.length)options[id].table.columns.forEach(function(value,key){-1===options[id].table.except.indexOf(value.text)&&(thead+=setThead(value.href,value.text,id))});else if("object"==typeof results[0])for(var key in results[0])-1===options[id].table.except.indexOf(key)&&(thead+=setThead(key,key,id));if(options[id].table.actions&&language?thead+="<th>"+language.actions+"</th>":options[id].table.actions&&!language&&(thead+="<th>"+options[id].table.actionsText+"</th>"),thead+="</tr></thead>","object"==typeof results){for(var key in tbody="<tbody>",results)tbody+=setTableRow(key,results[key],id);tbody+="</tbody>"}options[id].table.tfoot&&(tfoot=thead.replace("thead","tfoot"))}return thead+tbody+tfoot}function setThead(href,text,id){var thead="<th>{{{text}}}</th>";return options[id].table.headerOrder&&href&&(thead=thead.replace("{{{text}}}",'<a href="#'+href+'">{{{text}}}</a>')),thead=language&&language[text]?thead.replace("{{{text}}}",language[text]):thead.replace("{{{text}}}",text.replace("_"," "))}function setTableRow(key,value,id){var tr,trow="<tr "+(options[id].table.rowTr?options[id].table.rowTr(key,value):value.id?'data-id="'+value.id+'"':"")+">{{{row}}}</tr>",rowContent="";if(options[id].table.numbers&&(rowContent+='<td class="font-weight-bold">#'+(options[id].pagination.page*options[id].pagination.limit-options[id].pagination.limit+parseInt(key)+1)+"</td>"),"object"==typeof value)for(var key in value)if(-1===options[id].table.except.indexOf(key))if(options[id].table.rowItem){var rowItem=options[id].table.rowItem(key,value);rowContent+="<td>"+(rowItem||value[key])+"</td>"}else rowContent+="<td>"+value[key]+"</td>";return options[id].table.actions&&(rowContent+='<td><div class="btn-group dropleft"><button type="button" class="btn btn-md btn-'+options[id].table.actionColor+' dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+(language&&language.actions?language.actions:options[id].table.actionsText)+'</button><div class="dropdown-menu">',options[id].table.actions.forEach(function(_value,_key){if(_value.actionItem){var actionItem=_value.actionItem(key,value);rowContent+=actionItem}else rowContent+='<button data-action="'+_value.action+'" class="dropdown-item dropdown-item-blue" type="button"><i class="'+_value.icon+'"></i>'+(language?language[_value.text]:_value.text)+"</button>"}),rowContent+="</div></div></td>"),trow.replace("{{{row}}}",rowContent)}function searchOnTable(_this){var table=$(_this).parents("#jqson-table").find("table"),id=table.attr("id"),searchTerm=$("#table-search").val()?$("#table-search").val():"";id&&(options[id].pagination.like=searchTerm,loadTable(table,id),options[id].pagination.like="",setCookie(options[id].table.prefix+id+"_pagination",JSON.stringify(options[id].pagination),365))}function loadSelect(select,id){var data=null;if(options[id].ajax?(data=ajaxGetData(id)).results&&(data=data.results):options[id].results&&options[id].results.length?data=options[id].results:console.log("There is no ajax request or valid data (select)"),data){var optionHtml=optionBuilder(data,id);optionHtml?select.html(optionHtml):console.log("There is no builded option content (select)")}else console.log("No data (select)")}function loadSelectData(data,select,id){if(data){var optionHtml=optionBuilder(data,id);optionHtml?select.html(optionHtml):console.log("There is no builded option content (select)")}else console.log("No data (select)")}function optionBuilder(results,id){var optionsHtml="";if(options[id].defaultOption&&(optionsHtml+=options[id].defaultOption),results&&options[id].optionItem){if("object"==typeof results[0])for(var key in results)optionsHtml+=options[id].optionItem(key,results[key],options[id].selectedValue)}else results.forEach(function(el){var _el=Object.keys(el);el&&_el.length>1&&(optionsHtml+='<option value="'+el[_el[0]]+'">'+el[_el[1]]+"</option>")});return optionsHtml}function loadList(select,id){var data=null;if(options[id].ajax?(data=ajaxGetData(id)).results&&(data=data.results):options[id].results&&options[id].results.length?data=options[id].results:console.log("There is no ajax request or valid data (select)"),data){var optionHtml=listItemBuilder(data,id);optionHtml?select.html(optionHtml):console.log("There is no builded option content (list)")}else console.log("No data (list)")}function loadListData(data,select,id,returnHtml){if(data){var optionHtml=listItemBuilder(data,id);if(optionHtml){if(select)select.html(optionHtml);else if(returnHtml)return optionHtml}else console.log("There is no builded list item content (list)")}else console.log("No data (list)")}function listItemBuilder(data,id){var itemHtml="";if(data&&options[id].listItem){if("object"==typeof data[0])for(var key in data)itemHtml+=options[id].listItem(key,data[key],options[id].selectedValue)}else data&&(data.length?$.each(data,function(key,value){var _value=Object.keys(value);value&&_value.length>1&&("a"==options[id].itemType?itemHtml+='<a class="list-group-item list-group-item-action" href="'+value[_value[0]]+'">'+value[_value[1]]+"</a>":"button"==options[id].itemType?itemHtml+='<button type="button" class="list-group-item" data-value="'+value[_value[0]]+'">'+value[_value[1]]+"</button>":"li"==options[id].itemType&&(itemHtml+='<li class="list-group-item" data-value="'+value[_value[0]]+'">'+value[_value[1]]+"</li>"))}):$.each(data,function(key,value){var _value=Object.keys(value);value&&_value.length>1&&("a"==options[id].itemType?itemHtml+='<a class="list-group-item list-group-item-action" href="'+key+'">'+value+"</a>":"button"==options[id].itemType?itemHtml+='<button type="button" class="list-group-item" data-value="'+value[_value[0]]+'">'+value[_value[1]]+"</button>":"li"==options[id].itemType&&(itemHtml+='<li class="list-group-item">'+value+"</li>"))}));return itemHtml}$(document).on("click",".jqson-table thead th a, .jqson-table tfoot th a",function(e){e.preventDefault();var _this=$(this),order_by=_this.attr("href").replace("#",""),order=_this.attr("data-order"),table=_this.parents(".jqson-table"),id=table.attr("id"),item;if(options[id].pagination.order="desc"===options[id].pagination.order?"asc":"desc",options[id].pagination.order_by=order_by,void 0===order||"desc"==order)tableLoader(!0,table,id),(item=$('a[href="#'+order_by+'"]')).attr("data-order","asc").html(item[0].innerText+' <i class="fas fa-angle-double-up"></i>');else if("asc"==order){var item;tableLoader(!0,table,id),(item=$('a[href="#'+order_by+'"]')).attr("data-order","desc").html(item[0].innerText+' <i class="fas fa-angle-double-down"></i>')}}),$(document).on("click","#pagination button",function(){var _this=$(this),table=_this.parents("#jqson-table").find(".jqson-table"),id=table.attr("id"),index=_this.attr("data-index");options[id].pagination.page=index,tableLoader(!0,table,id),options[id].table.paginationHistory&&setCookie(options[id].table.prefix+id+"_pagination",JSON.stringify(options[id].pagination),365)}),$(document).on("click","#search-on-table",function(){var _this,searchBar=$(this).parents("#jqson-table").find("#jqson-search");searchBar.hasClass("d-none")?searchBar.removeClass("d-none"):searchBar.addClass("d-none")}),$(document).on("click","#table-search-button",function(){searchOnTable(this)}),$(document).on("blur","#table-search",function(e){searchOnTable(this)}),$(document).on("search","#table-search",function(e){searchOnTable(this)}),$(document).on("click","#refresh-table",function(){var table=$(this).parents("#jqson-table").find("table"),id=table.attr("id");options[id].pagination.like="",options[id].pagination.page=1,loadTable(table,id)}),$.fn.jqSonTable=function(customOptions){var _this=$(this);if(_this.length){var id=_this.attr("id"),prefix=_this.attr("data-table-prefix");if(customOptions&&(options[id]=$.extend(!0,{},tableDefaultOptions,customOptions)),!options[id].table.prefix.length&&prefix&&(options[id].table.prefix=prefix),options[id].table.paginationHistory&&prefix){var paginationHistory=getCookie(prefix+id+"_pagination");paginationHistory&&(options[id].pagination=JSON.parse(paginationHistory))}tableLoader(!0,_this,id)}},$.fn.jqSonTableLoadData=function(data,customOptions){var _this=$(this);if(_this.length){var id=_this.attr("id"),prefix=_this.attr("data-table-prefix");if(customOptions&&(options[id]=$.extend(!0,{},tableDefaultOptions,customOptions)),!options[id].table.prefix.length&&prefix&&(options[id].table.prefix=prefix),options[id].table.paginationHistory&&prefix){var paginationHistory=getCookie(prefix+id+"_pagination");paginationHistory&&(options[id].pagination=JSON.parse(paginationHistory))}loadTableData(data,_this,id)}},$.fn.jqSonTableReload=function(){tableLoader(!0,$(this))},$.jqSonTableOptions=function(customOptions){return customOptions&&$.extend(!0,tableDefaultOptions,customOptions),this},$.fn.jqSonSelect=function(customOptions){var _this=$(this);if(_this.length){var id=_this.attr("id");customOptions&&(options[id]=$.extend(!0,{},selectDefaultOptions,customOptions)),loadSelect(_this,id)}},$.fn.jqSonSelectLoadData=function(data,customOptions){var _this=$(this);if(_this.length){var id=_this.attr("id");customOptions&&(options[id]=$.extend(!0,{},selectDefaultOptions,customOptions)),loadSelectData(data,_this,id)}},$.fn.jqSonList=function(customOptions){var _this=$(this);if(console.log(_this.attr("id")),_this.length){var id=_this.attr("id");customOptions&&(options[id]=$.extend(!0,{},listDefaultOptions,customOptions)),loadList(_this,id)}},$.fn.jqSonListLoadData=function(data,customOptions){var _this=$(this);if(_this.length){var id=_this.attr("id");customOptions&&(options[id]=$.extend(!0,{},listDefaultOptions,customOptions)),loadListData(data,_this,id)}},$.jqSonListLoadData=function(data,customOptions,id){if(id)return customOptions&&(options[id]=$.extend(!0,{},listDefaultOptions,customOptions)),loadListData(data,null,id,!0)},$.jqSonLoadLang=function(lang){lang&&(language=lang)},$.jqSonInit=function(){tableLoader(!0)}}(jQuery);